<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LUNEVIRA — Auth Fix</title>

  <!-- مهم: defer حتى يتأكد التحميل -->
  <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>

  <style>
    body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff;padding:16px}
    .card{max-width:520px;margin:18px auto;border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.06);border-radius:18px;padding:16px}
    input{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.06);color:#fff;outline:none;margin-top:10px}
    button{padding:12px 14px;border-radius:14px;border:0;font-weight:900;cursor:pointer;margin-top:10px}
    .gold{background:linear-gradient(135deg,#f1d37a,#d4af37);color:#061018}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.15);color:#fff}
    .log{margin-top:12px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.15);
      background:rgba(0,0,0,.35);white-space:pre-wrap;line-height:1.7}
  </style>
</head>

<body>
  <div class="card">
    <h2 style="margin:0 0 8px">تسجيل / دخول</h2>

    <input id="email" type="email" placeholder="test123@gmail.com">
    <input id="pass" type="password" placeholder="12345678">

    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="gold" id="signup">تسجيل</button>
      <button class="ghost" id="signin">دخول</button>
      <button class="ghost" id="logout" style="display:none">خروج</button>
    </div>

    <div class="log" id="log">جاهز…</div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const log = (m)=> document.getElementById("log").textContent = String(m);

  // بياناتك
  const SUPABASE_URL = "https://muowobprjsaiqxlcrtav.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11b3dvYnByanNhaXF4bGNydGF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2Mjc4MDEsImV4cCI6MjA4NjIwMzgwMX0.KTK4yPFO-GZHSDG41JBq1H4kHO17iR7pr9lRU4crbfE";

  // تأكد أن المكتبة وصلت
  if (!window.supabase) {
    log("❌ مكتبة Supabase لم تُحمّل.\n- جرّب إيقاف AdBlock\n- أو جرّب متصفح آخر\n- أو جرّب شبكة أخرى");
    return;
  }

  // مهم: لا تستعمل اسم supabase كمتغير لأنه يسبب تضارب
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function refresh(){
    const { data, error } = await sb.auth.getSession();
    if(error){ log("Session error: " + error.message); return; }
    const u = data.session?.user;
    document.getElementById("logout").style.display = u ? "" : "none";
    log(u ? ("✅ أنت داخل: " + u.email) : "غير مسجل.");
  }

  document.getElementById("signup").onclick = async ()=>{
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("pass").value;
    if(!email.includes("@")) return log("❌ اكتب إيميل صحيح");
    if(password.length < 8) return log("❌ كلمة المرور 8 أحرف أو أكثر");

    log("… جاري التسجيل");
    const { data, error } = await sb.auth.signUp({ email, password });
    if(error) return log("❌ SignUp error: " + error.message);
    log("✅ SignUp OK.\n" + (data.session ? "Session created ✅" : "Session = null (Confirm Email مفعّل)"));
    await refresh();
  };

  document.getElementById("signin").onclick = async ()=>{
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("pass").value;
    log("… جاري الدخول");
    const { data, error } = await sb.auth.signInWithPassword({ email, password });
    if(error) return log("❌ SignIn error: " + error.message);
    log("✅ SignIn OK: " + (data.user?.email || "—"));
    await refresh();
  };

  document.getElementById("logout").onclick = async ()=>{
    await sb.auth.signOut();
    await refresh();
  };

  await refresh();
});
</script>
</body>
  </html>
