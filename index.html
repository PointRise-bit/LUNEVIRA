<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LUNEVIRA — اختبار التسجيل</title>
  <style>
    body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
    .box{max-width:520px;margin:18px auto;padding:16px}
    .card{border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);border-radius:16px;padding:14px}
    input{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#fff;outline:none;margin-top:10px}
    button{padding:12px 14px;border-radius:14px;border:0;font-weight:900;cursor:pointer;margin-top:10px}
    .a{background:linear-gradient(135deg,#f1d37a,#d4af37);color:#071018}
    .b{background:transparent;border:1px solid rgba(255,255,255,.15);color:#fff}
    .log{margin-top:12px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.35);white-space:pre-wrap;line-height:1.6}
    .small{opacity:.8;font-size:12px;line-height:1.7}
  </style>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
</head>
<body>
  <div class="box">
    <div class="card">
      <h2 style="margin:0 0 6px">اختبار تسجيل/دخول Supabase</h2>
      <div class="small">
        اكتب إيميل صحيح مثل: <b>test123@gmail.com</b><br/>
        كلمة المرور: 8 أحرف أو أكثر.
      </div>

      <input id="email" type="email" placeholder="test123@gmail.com" />
      <input id="pass" type="password" placeholder="12345678" />

      <button class="a" id="signup">تسجيل جديد</button>
      <button class="b" id="signin">دخول</button>
      <button class="b" id="logout" style="display:none">خروج</button>

      <div class="log" id="log">جاهز…</div>

      <div class="small" style="margin-top:10px">
        إذا ظهر لك خطأ هنا، انسخه وارسله لي وسأعطيك الحل النهائي فورًا.
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const log = (m)=>{ document.getElementById("log").textContent = String(m); };
  const emailEl = document.getElementById("email");
  const passEl  = document.getElementById("pass");

  // بياناتك (جاهزة)
  const SUPABASE_URL = "https://muowobprjsaiqxlcrtav.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11b3dvYnByanNhaXF4bGNydGF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2Mjc4MDEsImV4cCI6MjA4NjIwMzgwMX0.KTK4yPFO-GZHSDG41JBq1H4kHO17iR7pr9lRU4crbfE";

  await new Promise(r=>setTimeout(r, 50));

  if(!window.supabase){
    log("❌ مكتبة Supabase لم تُحمّل (شبكتك تمنع unpkg أو يوجد مانع إعلانات). جرّب شبكة أخرى أو أوقف AdBlock.");
    return;
  }

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function refresh(){
    const { data, error } = await supabase.auth.getSession();
    if(error) log("Session error: " + error.message);
    const user = data.session?.user || null;
    document.getElementById("logout").style.display = user ? "" : "none";
    log(user ? ("✅ أنت داخل: " + user.email) : "غير مسجّل. جرّب تسجيل جديد/دخول.");
  }

  document.getElementById("signup").onclick = async () => {
    try{
      const email = emailEl.value.trim();
      const password = passEl.value;
      if(!email.includes("@")) { log("❌ اكتب إيميل صحيح (يحتوي @)"); return; }
      if(password.length < 8) { log("❌ كلمة المرور لازم 8 أحرف أو أكثر"); return; }

      log("… جاري إنشاء حساب");
      const { data, error } = await supabase.auth.signUp({ email, password });

      if(error) { log("❌ SignUp error: " + error.message); return; }

      // قد يحتاج تأكيد بريد حسب إعداداتك
      log("✅ SignUp OK.\n" +
          (data.user?.email ? ("User: " + data.user.email + "\n") : "") +
          (data.session ? "Session created ✅" : "Session = null (غالبًا Confirm Email مفعّل)"));
      await refresh();
    }catch(e){
      log("❌ Crash: " + (e?.message || e));
    }
  };

  document.getElementById("signin").onclick = async () => {
    try{
      const email = emailEl.value.trim();
      const password = passEl.value;
      log("… جاري تسجيل الدخول");
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if(error) { log("❌ SignIn error: " + error.message); return; }
      log("✅ SignIn OK: " + (data.user?.email || "—"));
      await refresh();
    }catch(e){
      log("❌ Crash: " + (e?.message || e));
    }
  };

  document.getElementById("logout").onclick = async () => {
    await supabase.auth.signOut();
    await refresh();
  };

  await refresh();
});
</script>
</body>
        </html>
